import TelegramBot from 'node-telegram-bot-api'

// –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∫–∏
const ADMIN_BOT_TOKEN = '7547528586:AAEBatSwuQCS6y5iGmtT9lJYyO3eVjIlEAk'

let adminBot: TelegramBot | null = null

// –°—Ç–∏–∫–µ—Ä –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ (—Å–µ—Ä—å—ë–∑–Ω—ã–π/–¥–µ–ª–æ–≤–æ–π)
const ADMIN_STICKER = 'CAACAgIAAxkBAAEBJ_Zl8K8AAXKvAAHxAAGKAAFnAAHqAAHqAAEAAQADAgADdwADNQQ'

export function startAdminBot(): boolean {
    if (adminBot) {
        console.log('‚ÑπÔ∏è –ê–¥–º–∏–Ω-–±–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω')
        return true
    }

    try {
        adminBot = new TelegramBot(ADMIN_BOT_TOKEN, { polling: true })
        setupAdminBotHandlers(adminBot)
        console.log('üëî –ê–¥–º–∏–Ω-–±–æ—Ç VapeCity –∑–∞–ø—É—â–µ–Ω!')
        return true
    } catch (err: any) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞–¥–º–∏–Ω-–±–æ—Ç–∞:', err.message)
        adminBot = null
        return false
    }
}

function setupAdminBotHandlers(bot: TelegramBot) {
    bot.onText(/\/start/, async (msg) => {
        const chatId = msg.chat.id
        const firstName = msg.from?.first_name || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∏–∫–µ—Ä
        try {
            await bot.sendSticker(chatId, ADMIN_STICKER)
        } catch (e) {
            // –°—Ç–∏–∫–µ—Ä –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω
        }

        const welcomeText = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${firstName}! üëî

–≠—Ç–æ <b>–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VapeCity</b> ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —Å–µ—Ç–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤.

üîê <b>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</b>
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –≤–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å. –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤–ª–∞–¥–µ–ª—å—Ü—É –∏–ª–∏ –¥–µ–π—Å—Ç–≤—É—é—â–µ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.

üìä <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</b>
‚Ä¢ –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã —Å —Ñ–æ—Ç–æ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º
‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ü–µ–Ω—ã –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
‚Ä¢ –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –±—Ä–µ–Ω–¥–∞–º–∏
‚Ä¢ –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ Excel-—Ñ–∞–π–ª–æ–≤

üìç <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∞–º–∏</b>
‚Ä¢ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –º–∞–≥–∞–∑–∏–Ω—ã
‚Ä¢ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã
‚Ä¢ –ù–∞–∑–Ω–∞—á–∞–π—Ç–µ –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ –Ω–∞ —Ç–æ—á–∫–∏
‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –æ—Å—Ç–∞—Ç–∫–∏ –Ω–∞ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ

üì¶ <b>–°–∫–ª–∞–¥—Å–∫–æ–π —É—á—ë—Ç</b>
‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
‚Ä¢ –ü–µ—Ä–µ–º–µ—â–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—ã –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
‚Ä¢ –ü–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∏–∑–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö
‚Ä¢ –°–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –¥–≤–∏–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤

üìã <b>–ë—Ä–æ–Ω–∏ –∏ –∑–∞–∫–∞–∑—ã</b>
‚Ä¢ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –≤—Å–µ –±—Ä–æ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚Ä¢ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ—Ç—á—ë—Ç—ã

üë• <b>–ö–ª–∏–µ–Ω—Ç—ã –∏ –±–æ–Ω—É—Å—ã</b>
‚Ä¢ –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –±–æ–Ω—É—Å–Ω—ã–º–∏ –±–∞–ª–ª–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
‚Ä¢ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∫—É–ø–æ–∫
‚Ä¢ –ù–∞—á–∏—Å–ª—è–π—Ç–µ –∏ —Å–ø–∏—Å—ã–≤–∞–π—Ç–µ –±–∞–ª–ª—ã –≤—Ä—É—á–Ω—É—é

‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b>
‚Ä¢ –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
‚Ä¢ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚Ä¢ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–π—Ç–µ –±–æ–Ω—É—Å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>¬´–ê–¥–º–∏–Ω–∫–∞¬ª</b> –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. üöÄ`

        await bot.sendMessage(chatId, welcomeText, { parse_mode: 'HTML' })
    })
}


export function stopAdminBot() {
    if (adminBot) {
        adminBot.stopPolling()
        adminBot = null
        console.log('üõë –ê–¥–º–∏–Ω-–±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω')
    }
}

export function isAdminBotRunning(): boolean {
    return adminBot !== null
}

export default adminBot
